<% local v2ray_version=luci.sys.exec("/usr/bin/xray -version | awk '{print $2}' | sed -n 1P") -%>

	<script type="text/javascript">
		//<![CDATA[
		var v2rayInfo;
		var tokenStr = '<%=token%>';
		var noUpdateText = '<%:It is the latest version%>';
		var updateSuccessText = '<%:Update successful%>';
		var clickToUpdateText = '<%:Click to update%>';
		var inProgressText = '<%:Updating...%>';
		var unexpectedErrorText = '<%:Unexpected error%>';
		var updateInProgressNotice = '<%:Updating, are you sure to close?%>';
		var downloadingText = '<%:Downloading...%>';
		var decompressioningText = '<%:Unpacking...%>';
		var movingText = '<%:Moving...%>';

		window.onload = function () {
			var v2rayCheckBtn = document.getElementById('_v2ray-check_btn');
			var v2rayDetailElm = document.getElementById('_v2ray-check_btn-detail');
		};

		function addPageNotice_v2ray() {
			window.onbeforeunload = function (e) {
				e.returnValue = updateInProgressNotice;
				return updateInProgressNotice;
			};
		}

		function removePageNotice_v2ray() {
			window.onbeforeunload = undefined;
		}

		function onUpdateSuccess_v2ray(btn) {
			alert(updateSuccessText);

			if (btn) {
				btn.value = updateSuccessText;
				btn.placeholder = updateSuccessText;
				btn.disabled = true;
			}

			window.setTimeout(function () {
				window.location.reload();
			}, 1000);
		}

		function onRequestError_v2ray(btn, errorMessage) {
			btn.disabled = false;
			btn.value = btn.placeholder;

			if (errorMessage) {
				alert(errorMessage);
			}
		}

		function doAjaxGet(url, data, onResult) {
			new XHR().get(url, data, function (_, json) {
				var resultJson = json || {
					'code': 1,
					'error': unexpectedErrorText
				};

				if (typeof onResult === 'function') {
					onResult(resultJson);
				}
			})
		}

	//]]>
	</script>

	<div class="cbi-value">
		<label class="cbi-value-title">V2ray
			<%:Version%>
		</label>
		<div class="cbi-value-field">
			<div class="cbi-value-description">
				<span>【 <%=v2ray_version%>】</span>
			</div>
		</div>
	</div>